<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professioneller Arbeitszeit-Rechner mit speziellen Zuschlagsregelungen, 3-Stunden-Regel und Monatsauswertung f√ºr deutsche Arbeitszeiten.">
    <meta name="keywords" content="Arbeitszeit, Rechner, Zuschl√§ge, Stundenliste, √úberstunden, Arbeitszeit berechnen">
    <meta name="author" content="Arbeitszeit-Rechner">
    
    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Arbeitszeit-Rechner - Professionelle Zeiterfassung">
    <meta property="og:description" content="Berechnen Sie Arbeitszeiten mit speziellen Zuschlagsregelungen, 3-Stunden-Regel und erstellen Sie Monatslisten.">
    <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23667eea;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23764ba2;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23grad)'/%3E%3Ctext x='600' y='300' font-family='Arial, sans-serif' font-size='72' font-weight='bold' text-anchor='middle' fill='white'%3E‚è∞ Arbeitszeit-Rechner%3C/text%3E%3Ctext x='600' y='380' font-family='Arial, sans-serif' font-size='32' text-anchor='middle' fill='white' opacity='0.9'%3EProfessionelle Zeiterfassung mit Zuschlagsregelungen%3C/text%3E%3C/svg%3E">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='15' fill='%23667eea'/%3E%3Ctext x='16' y='22' font-family='Arial' font-size='18' text-anchor='middle' fill='white'%3E‚è∞%3C/text%3E%3C/svg%3E">
    
    <title>Arbeitszeit-Rechner mit Monatsliste</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .content {
            padding: 30px;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .mode-btn {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .input-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #495057;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input, select {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .time-input-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .time-input-group select {
            padding: 8px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 0.9rem;
            min-width: 60px;
        }

        .time-separator {
            font-weight: bold;
            color: #495057;
        }

        .time-input-quick {
            width: 60px;
            padding: 4px;
            font-size: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }

        .time-input-quick:focus {
            border-color: #667eea;
            background-color: #f0f8ff;
            outline: none;
        }

        .day-inputs-quick {
            display: grid;
            grid-template-columns: 60px 60px;
            gap: 5px;
            margin-bottom: 10px;
            align-items: center;
        }

        .input-labels {
            display: grid;
            grid-template-columns: 60px 60px;
            gap: 5px;
            margin-bottom: 5px;
            font-size: 0.7rem;
            color: #666;
        }

        .day-inputs-additional {
            display: grid;
            grid-template-columns: 60px 60px;
            gap: 5px;
            margin-bottom: 5px;
            align-items: center;
        }

        .time-block {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }

        .time-block h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 25px 0;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .results {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .results h3 {
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .result-item .label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .result-item .value {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .rules-info {
            background: #e3f2fd;
            border: 2px solid #bbdefb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #1565c0;
        }

        .rules-info h4 {
            margin-bottom: 10px;
            color: #0d47a1;
        }

        .month-header {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .month-calendar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .day-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            flex-wrap: wrap;
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            min-width: 30px;
        }

        .weekday {
            font-size: 0.9rem;
            color: #6c757d;
            text-align: right;
            flex: 1;
            margin-left: 10px;
        }

        .day-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .day-inputs input {
            padding: 8px;
            font-size: 0.9rem;
        }

        .day-summary {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            color: #495057;
        }

        .month-summary {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .export-section {
            text-align: center;
            margin-top: 20px;
        }

        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .print-table th,
        .print-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .print-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .print-table tr:hover {
            background: #f8f9fa;
        }

        .footer {
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            padding: 20px;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .footer a {
            color: #667eea;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-group {
                grid-template-columns: 1fr;
            }
            
            .time-blocks {
                grid-template-columns: 1fr;
            }

            .month-calendar {
                grid-template-columns: 1fr;
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
            }

            .day-inputs {
                grid-template-columns: 1fr;
            }
        }

        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
                background: white;
            }
            .mode-selector,
            .button-group,
            .export-section,
            .footer {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚è∞ Arbeitszeit-Rechner</h1>
            <p>Einzelberechnung und Monatsliste mit speziellen Zuschlagsregelungen</p>
        </div>
        
        <div class="content">
            <div class="mode-selector">
                <div class="mode-btn active" onclick="switchMode('single')">
                    üìã Einzelberechnung
                </div>
                <div class="mode-btn" onclick="switchMode('monthly')">
                    üìÖ Monatsliste
                </div>
            </div>

            <!-- Einzelberechnung -->
            <div id="single-mode" class="section active">
                <div class="rules-info">
                    <h4>üìã Besondere 3-Stunden-Regel:</h4>
                    <p><strong>Wenn Sie in kritischen Zeitbereichen 3+ Stunden durchgehend arbeiten, werden ALLE Stunden in diesem Bereich als 100% steuerfrei bewertet:</strong></p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li><strong>Mo-Do:</strong> 16:45-22:00 Uhr (+ Nachtstunden 0:00-6:00)</li>
                        <li><strong>Fr:</strong> 12:00-22:00 Uhr (+ Nachtstunden 0:00-6:00)</li>
                        <li><strong>Sa:</strong> 6:00-22:00 Uhr (+ Nachtstunden 0:00-6:00)</li>
                    </ul>
                    <p><strong>üìã Pausenregelung:</strong> Kreuzen Sie "Pause" pro Tag an, wenn eine 45-Minuten-Pause von der Arbeitszeit abgezogen werden soll.</p>
                </div>

                <div class="input-section">
                    <h3>üìÖ Arbeitszeit eingeben</h3>
                    
                    <div class="form-group">
                        <div class="form-field">
                            <label for="workday">Wochentag</label>
                            <select id="workday">
                                <option value="monday">Montag</option>
                                <option value="tuesday">Dienstag</option>
                                <option value="wednesday">Mittwoch</option>
                                <option value="thursday">Donnerstag</option>
                                <option value="friday">Freitag</option>
                                <option value="saturday">Samstag</option>
                                <option value="sunday">Sonntag</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label for="isHoliday">Feiertag?</label>
                            <select id="isHoliday">
                                <option value="false">Nein</option>
                                <option value="true">Ja</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label>
                                <input type="checkbox" id="hasPause"> Mittagspause (0:45h) abziehen
                            </label>
                        </div>
                    </div>

                    <div class="time-blocks">
                        <div class="time-block">
                            <h4>üïê Hauptarbeitszeit</h4>
                            <div class="form-group">
                                <div class="form-field">
                                    <label>Beginn</label>
                                    <div class="time-input-group">
                                        <select id="startHour1">
                                            <option value="">--</option>
                                        </select>
                                        <span class="time-separator">:</span>
                                        <select id="startMin1">
                                            <option value="">--</option>
                                            <option value="00">00</option>
                                            <option value="15">15</option>
                                            <option value="30">30</option>
                                            <option value="45">45</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-field">
                                    <label>Ende</label>
                                    <div class="time-input-group">
                                        <select id="endHour1">
                                            <option value="">--</option>
                                        </select>
                                        <span class="time-separator">:</span>
                                        <select id="endMin1">
                                            <option value="">--</option>
                                            <option value="00">00</option>
                                            <option value="15">15</option>
                                            <option value="30">30</option>
                                            <option value="45">45</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="additionalTimeBlocks">
                            <!-- Zus√§tzliche Arbeitszeit-Bl√∂cke werden hier dynamisch hinzugef√ºgt -->
                        </div>

                        <div style="text-align: center; margin: 15px 0;">
                            <button type="button" onclick="addTimeBlock()" class="btn-success" style="min-width: auto; padding: 8px 15px;">+ Weitere Arbeitszeit</button>
                            <button type="button" onclick="removeTimeBlock()" class="btn-secondary" style="min-width: auto; padding: 8px 15px;">- Entfernen</button>
                        </div>
                    </div>

                    <div class="button-group">
                        <button onclick="calculateWorkTime()">üßÆ Berechnen</button>
                        <button class="btn-secondary" onclick="clearSingle()">üóëÔ∏è Zur√ºcksetzen</button>
                    </div>
                </div>

                <div id="results" class="results" style="display: none;">
                    <h3>üìä Berechnungsergebnis</h3>
                    <div id="resultContent" class="result-grid"></div>
                </div>
            </div>

            <!-- Monatsliste -->
            <div id="monthly-mode" class="section">
                <div class="month-header">
                    <h3>üìÖ Monatsliste erstellen</h3>
                    
                    <div class="form-group">
                        <div class="form-field">
                            <label for="employeeName">Name</label>
                            <input type="text" id="employeeName" placeholder="Name des Mitarbeiters">
                        </div>
                        
                        <div class="form-field">
                            <label for="selectedMonth">Monat</label>
                            <input type="month" id="selectedMonth">
                        </div>
                    </div>

                    <div class="button-group">
                        <button onclick="generateMonthCalendar()">üìã Monat generieren</button>
                        <button class="btn-success" onclick="calculateMonthTotal()">üìä Monatsauswertung</button>
                        <button class="btn-secondary" onclick="clearMonth()">üóëÔ∏è Zur√ºcksetzen</button>
                    </div>
                </div>

                <div id="monthCalendar" class="month-calendar"></div>

                <div id="monthSummary" class="month-summary" style="display: none;">
                    <h3>üìä Monatsauswertung</h3>
                    <div id="monthSummaryContent"></div>
                    
                    <div class="export-section">
                        <button onclick="printOfficialPDF()" class="btn-secondary">üñ®Ô∏è Offizielle Stundenliste drucken</button>
                    </div>
                </div>

                <div id="printTable" style="display: none;"></div>
            </div>
        </div>
        
        <div class="footer">
            <p>‚è∞ Arbeitszeit-Rechner - Professionelle Zeiterfassung | 
            <a href="https://github.com" target="_blank" rel="noopener">üìÇ GitHub Repository</a></p>
        </div>
    </div>

    <script>
        let monthData = {};
        let singleModeTimeBlocks = 1; // Startet mit 1 Block

        function formatTimeInput(input) {
            let value = input.value.replace(/[^\d]/g, ''); // Nur Zahlen
            
            if (value.length === 0) {
                input.value = '';
                return;
            }
            
            // Auto-Format verschiedener Eingaben
            if (value.length <= 2) {
                // 1-2 Stellen: als Stunden interpretieren
                let hours = parseInt(value);
                if (hours > 23) hours = 23;
                input.value = hours.toString().padStart(2, '0') + ':00';
            } else if (value.length === 3) {
                // 3 Stellen: erste als Stunde, letzte zwei als Minuten (z.B. 730 -> 07:30)
                let hours = parseInt(value.substring(0, 1));
                let minutes = parseInt(value.substring(1, 3));
                if (hours > 23) hours = 23;
                if (minutes > 59) minutes = 59;
                // Runde auf 15-Minuten-Schritte
                minutes = Math.round(minutes / 15) * 15;
                if (minutes === 60) { minutes = 0; hours++; }
                if (hours > 23) hours = 23;
                input.value = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0');
            } else if (value.length >= 4) {
                // 4+ Stellen: erste zwei als Stunden, n√§chste zwei als Minuten
                let hours = parseInt(value.substring(0, 2));
                let minutes = parseInt(value.substring(2, 4));
                if (hours > 23) hours = 23;
                if (minutes > 59) minutes = 59;
                // Runde auf 15-Minuten-Schritte
                minutes = Math.round(minutes / 15) * 15;
                if (minutes === 60) { minutes = 0; hours++; }
                if (hours > 23) hours = 23;
                input.value = hours.toString().padStart(2, '0') + ':' + minutes.toString().padStart(2, '0');
            }
        }

        function handleTimeKeyDown(event) {
            // Enter oder Tab: zum n√§chsten Feld
            if (event.key === 'Enter' || event.key === 'Tab') {
                formatTimeInput(event.target);
                updateDaySummary(event.target.dataset.day);
                
                if (event.key === 'Enter') {
                    event.preventDefault();
                    // Finde n√§chstes Eingabefeld
                    const inputs = Array.from(document.querySelectorAll('.time-input-quick'));
                    const currentIndex = inputs.indexOf(event.target);
                    const nextInput = inputs[currentIndex + 1];
                    if (nextInput) {
                        nextInput.focus();
                        nextInput.select();
                    }
                }
            }
        }

        function handleTimeBlur(event) {
            formatTimeInput(event.target);
            updateDaySummary(event.target.dataset.day);
        }

        function getTimeFromInput(inputId) {
            const input = document.getElementById(inputId);
            return input ? input.value : '';
        }

        function populateHourOptions(selectElement) {
            for (let i = 0; i < 24; i++) {
                const option = document.createElement('option');
                const hourStr = i.toString().padStart(2, '0');
                option.value = hourStr;
                option.textContent = hourStr;
                selectElement.appendChild(option);
            }
        }

        function getTimeFromSelects(hourSelectId, minSelectId) {
            const hourSelect = document.getElementById(hourSelectId);
            const minSelect = document.getElementById(minSelectId);
            
            if (!hourSelect || !minSelect || !hourSelect.value || !minSelect.value) {
                return '';
            }
            
            return `${hourSelect.value}:${minSelect.value}`;
        }

        function setTimeToSelects(hourSelectId, minSelectId, timeStr) {
            if (!timeStr) return;
            
            const [hours, minutes] = timeStr.split(':');
            const hourSelect = document.getElementById(hourSelectId);
            const minSelect = document.getElementById(minSelectId);
            
            if (hourSelect && minSelect) {
                hourSelect.value = hours;
                minSelect.value = minutes;
            }
        }

        function timeToMinutes(timeStr) {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function addDayTimeBlock(day) {
            if (!monthData[day]) return;
            
            monthData[day].timeBlocks++;
            const timeInputsDiv = document.getElementById(`timeInputs_${day}`);
            const blockNum = monthData[day].timeBlocks;
            
            const newInputs = document.createElement('div');
            newInputs.className = 'day-inputs-additional';
            newInputs.id = `timeBlock_${day}_${blockNum}`;
            newInputs.style.marginTop = '5px';
            
            // Erste zus√§tzliche Arbeitszeit bekommt Labels
            if (blockNum === 2) {
                newInputs.innerHTML = `
                    <div style="grid-column: span 2; font-size: 0.7rem; color: #666; margin-bottom: 3px; display: grid; grid-template-columns: 60px 60px; gap: 5px;">
                        <div>Beginn ${blockNum}</div>
                        <div>Ende ${blockNum}</div>
                    </div>
                    <input type="text" 
                           class="time-input-quick" 
                           id="start${blockNum}_${day}" 
                           data-day="${day}"
                           placeholder="18:00"
                           onkeydown="handleTimeKeyDown(event)"
                           onblur="handleTimeBlur(event)"
                           tabindex="${day * 10 + blockNum * 2 + 1}">
                    <input type="text" 
                           class="time-input-quick" 
                           id="end${blockNum}_${day}" 
                           data-day="${day}"
                           placeholder="22:00"
                           onkeydown="handleTimeKeyDown(event)"
                           onblur="handleTimeBlur(event)"
                           tabindex="${day * 10 + blockNum * 2 + 2}">
                `;
            } else {
                // Weitere Bl√∂cke ohne Labels
                newInputs.innerHTML = `
                    <input type="text" 
                           class="time-input-quick" 
                           id="start${blockNum}_${day}" 
                           data-day="${day}"
                           placeholder="--:--"
                           onkeydown="handleTimeKeyDown(event)"
                           onblur="handleTimeBlur(event)"
                           tabindex="${day * 10 + blockNum * 2 + 1}">
                    <input type="text" 
                           class="time-input-quick" 
                           id="end${blockNum}_${day}" 
                           data-day="${day}"
                           placeholder="--:--"
                           onkeydown="handleTimeKeyDown(event)"
                           onblur="handleTimeBlur(event)"
                           tabindex="${day * 10 + blockNum * 2 + 2}">
                `;
            }
            
            timeInputsDiv.appendChild(newInputs);
        }

        function removeDayTimeBlock(day) {
            if (!monthData[day] || monthData[day].timeBlocks <= 1) return;
            
            const blockToRemove = document.getElementById(`timeBlock_${day}_${monthData[day].timeBlocks}`);
            if (blockToRemove) {
                blockToRemove.remove();
                monthData[day].timeBlocks--;
                updateDaySummary(day);
            }
        }

        function copyToWeek(day) {
            if (!monthData[day]) return;
            
            const startTime1 = getTimeFromInput(`start1_${day}`);
            const endTime1 = getTimeFromInput(`end1_${day}`);
            const isHoliday = document.getElementById(`holiday_${day}`).checked;
            const hasPause = document.getElementById(`pause_${day}`).checked;
            const dienst1 = document.getElementById(`dienst1_${day}`).checked;
            const dienst2 = document.getElementById(`dienst2_${day}`).checked;
            const einsatzpauschalen = parseInt(document.getElementById(`einsatzpauschalen_${day}`).value) || 0;
            
            if (!startTime1 && !endTime1 && !dienst1 && !dienst2 && einsatzpauschalen === 0) {
                alert('Bitte erst Zeiten oder Dienste f√ºr diesen Tag eingeben.');
                return;
            }
            
            // Sammle alle zus√§tzlichen Arbeitszeiten
            const additionalTimes = [];
            for (let i = 2; i <= monthData[day].timeBlocks; i++) {
                const start = getTimeFromInput(`start${i}_${day}`);
                const end = getTimeFromInput(`end${i}_${day}`);
                if (start && end) {
                    additionalTimes.push({ start, end });
                }
            }
            
            // Finde alle Tage der gleichen Woche
            const currentDate = monthData[day].date;
            const monday = new Date(currentDate);
            monday.setDate(currentDate.getDate() - currentDate.getDay() + 1);
            
            for (let i = 0; i < 7; i++) {
                const targetDate = new Date(monday);
                targetDate.setDate(monday.getDate() + i);
                const targetDay = targetDate.getDate();
                
                if (monthData[targetDay] && targetDay !== day) {
                    // Grunddaten setzen
                    const targetInput1 = document.getElementById(`start1_${targetDay}`);
                    const targetInput2 = document.getElementById(`end1_${targetDay}`);
                    const targetHoliday = document.getElementById(`holiday_${targetDay}`);
                    const targetPause = document.getElementById(`pause_${targetDay}`);
                    const targetDienst1 = document.getElementById(`dienst1_${targetDay}`);
                    const targetDienst2 = document.getElementById(`dienst2_${targetDay}`);
                    const targetEinsatzpauschalen = document.getElementById(`einsatzpauschalen_${targetDay}`);
                    
                    if (targetInput1) targetInput1.value = startTime1;
                    if (targetInput2) targetInput2.value = endTime1;
                    if (targetHoliday) targetHoliday.checked = isHoliday;
                    if (targetPause) targetPause.checked = hasPause;
                    if (targetDienst1) targetDienst1.checked = dienst1;
                    if (targetDienst2) targetDienst2.checked = dienst2;
                    if (targetEinsatzpauschalen) targetEinsatzpauschalen.value = einsatzpauschalen;
                    
                    // Zus√§tzliche Arbeitszeiten hinzuf√ºgen falls vorhanden
                    additionalTimes.forEach((time, index) => {
                        const blockNum = index + 2;
                        
                        // F√ºge Block hinzu falls noch nicht vorhanden
                        while (monthData[targetDay].timeBlocks < blockNum) {
                            addDayTimeBlock(targetDay);
                        }
                        
                        const startInput = document.getElementById(`start${blockNum}_${targetDay}`);
                        const endInput = document.getElementById(`end${blockNum}_${targetDay}`);
                        
                        if (startInput) startInput.value = time.start;
                        if (endInput) endInput.value = time.end;
                    });
                    
                    monthData[targetDay].isHoliday = isHoliday;
                    monthData[targetDay].hasPause = hasPause;
                    monthData[targetDay].dienst1 = dienst1;
                    monthData[targetDay].dienst2 = dienst2;
                    monthData[targetDay].einsatzpauschalen = einsatzpauschalen;
                    
                    updateDaySummary(targetDay);
                }
            }
            
            alert('Zeiten und Dienste wurden in die ganze Woche kopiert!');
        }

        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }

        function minutesToHours(minutes) {
            return (minutes / 60).toFixed(2);
        }

        function getWeekday(date) {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            return days[date.getDay()];
        }

        function getWeekdayName(date) {
            const days = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
            return days[date.getDay()];
        }

        function getFullWeekdayName(date) {
            const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
            return days[date.getDay()];
        }

        function getTimeRules(day, isHoliday) {
            if (isHoliday || day === 'sunday') {
                return [{ start: 0, end: 1440, type: 'tax_free_100' }];
            }

            switch (day) {
                case 'monday':
                case 'tuesday':
                case 'wednesday':
                case 'thursday':
                    return [
                        { start: 0, end: 360, type: 'tax_free_100' },      // 0:00-6:00
                        { start: 360, end: 450, type: 'surcharge_50' },    // 6:00-7:30
                        { start: 450, end: 720, type: 'normal' },          // 7:30-12:00 (4.5h Normal)
                        { start: 720, end: 765, type: 'normal' },          // 12:00-12:45 (0.75h Normal oder Pause)
                        { start: 765, end: 1005, type: 'normal' },         // 12:45-16:45 (4h Normal)
                        { start: 1005, end: 1125, type: 'surcharge_50' },  // 16:45-18:45
                        { start: 1125, end: 1320, type: 'taxed_100' },     // 18:45-22:00
                        { start: 1320, end: 1440, type: 'tax_free_100' }   // 22:00-24:00
                    ];
                case 'friday':
                    return [
                        { start: 0, end: 360, type: 'tax_free_100' },      // 0:00-6:00
                        { start: 360, end: 450, type: 'surcharge_50' },    // 6:00-7:30
                        { start: 450, end: 720, type: 'normal' },          // 7:30-12:00 (4.5h Normal)
                        { start: 720, end: 1125, type: 'surcharge_50' },   // 12:00-18:45 (50% Zuschlag)
                        { start: 1125, end: 1320, type: 'taxed_100' },     // 18:45-22:00
                        { start: 1320, end: 1440, type: 'tax_free_100' }   // 22:00-24:00
                    ];
                case 'saturday':
                    return [
                        { start: 0, end: 360, type: 'tax_free_100' },      // 0:00-6:00
                        { start: 360, end: 1320, type: 'taxed_100' },      // 6:00-22:00
                        { start: 1320, end: 1440, type: 'tax_free_100' }   // 22:00-24:00
                    ];
                default:
                    return [];
            }
        }

        function timeToMinutes(timeStr) {
            if (!timeStr) return 0;
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function calculateTimeSegment(startTime, endTime, rules, day, hasPause = false) {
            const result = {
                normal: 0,
                surcharge_50: 0,
                taxed_100: 0,
                tax_free_100: 0
            };

            // Behandle Zeiten √ºber Mitternacht (wenn Endzeit < Startzeit)
            if (endTime < startTime) {
                endTime += 1440; // F√ºge 24 Stunden hinzu
            }

            // Definiere kritische Zeitbereiche f√ºr 3-Stunden-Regel je nach Wochentag
            let criticalPeriods = [];
            
            switch (day) {
                case 'monday':
                case 'tuesday':
                case 'wednesday':
                case 'thursday':
                    criticalPeriods = [
                        { start: 1005, end: 1320, name: 'evening' }, // 16:45-22:00
                        { start: 0, end: 360, name: 'night' }       // 0:00-6:00
                    ];
                    break;
                case 'friday':
                    criticalPeriods = [
                        { start: 720, end: 1320, name: 'afternoon_evening' }, // 12:00-22:00
                        { start: 0, end: 360, name: 'night' }                 // 0:00-6:00
                    ];
                    break;
                case 'saturday':
                    criticalPeriods = [
                        { start: 360, end: 1320, name: 'day_evening' }, // 6:00-22:00
                        { start: 0, end: 360, name: 'night' }           // 0:00-6:00
                    ];
                    break;
                default:
                    criticalPeriods = [];
            }

            // Pr√ºfe 3-Stunden-Regel f√ºr jeden kritischen Zeitbereich
            const threeHourPeriods = [];
            for (const period of criticalPeriods) {
                let periodStart = period.start;
                let periodEnd = period.end;
                
                // Behandle Perioden √ºber Mitternacht
                if (startTime >= 1440) {
                    periodStart += 1440;
                    periodEnd += 1440;
                }
                
                const workInPeriodStart = Math.max(startTime, periodStart);
                const workInPeriodEnd = Math.min(endTime, periodEnd);
                
                if (workInPeriodStart < workInPeriodEnd) {
                    const minutesInPeriod = workInPeriodEnd - workInPeriodStart;
                    if (minutesInPeriod >= 180) { // 3+ Stunden in diesem Zeitbereich
                        threeHourPeriods.push({
                            start: workInPeriodStart,
                            end: workInPeriodEnd,
                            name: period.name
                        });
                    }
                }
            }

            // Normale Berechnung nach Zeitregeln
            for (const rule of rules) {
                let ruleStart = rule.start;
                let ruleEnd = rule.end;
                
                // Wenn gesamte Arbeitszeit nach Mitternacht liegt
                if (startTime >= 1440) {
                    ruleStart += 1440;
                    ruleEnd += 1440;
                }
                
                const segmentStart = Math.max(startTime, ruleStart);
                const segmentEnd = Math.min(endTime, ruleEnd);
                
                if (segmentStart < segmentEnd) {
                    let minutes = segmentEnd - segmentStart;
                    let ruleType = rule.type;
                    
                    // Spezielle Behandlung f√ºr Mittagszeit 12:00-12:45 an Mo-Do
                    if ((day === 'monday' || day === 'tuesday' || day === 'wednesday' || day === 'thursday') &&
                        rule.start === 720 && rule.end === 765) { // 12:00-12:45
                        
                        if (hasPause) {
                            // Bei Pause: Diese Zeit gar nicht z√§hlen
                            continue;
                        } else {
                            // Ohne Pause: Als 50% Zuschlag z√§hlen
                            ruleType = 'surcharge_50';
                        }
                    }
                    
                    // Pr√ºfe ob dieser Bereich von 3-Stunden-Regel betroffen ist
                    let isThreeHourPeriod = false;
                    for (const threeHour of threeHourPeriods) {
                        if (segmentStart >= threeHour.start && segmentEnd <= threeHour.end) {
                            isThreeHourPeriod = true;
                            break;
                        }
                    }
                    
                    if (isThreeHourPeriod && (ruleType === 'surcharge_50' || ruleType === 'taxed_100')) {
                        result.tax_free_100 += minutes;
                    } else if (result[ruleType] !== undefined) {
                        result[ruleType] += minutes;
                    }
                }
            }

            return result;
        }

        function calculateDayWorkTime(timeBlocks, day, isHoliday, hasPause = false) {
            if (!timeBlocks || timeBlocks.length === 0) {
                return {
                    normal: 0,
                    surcharge_50: 0,
                    taxed_100: 0,
                    tax_free_100: 0,
                    break_time: 0,
                    display_break_time: 0
                };
            }

            const rules = getTimeRules(day, isHoliday);
            let totalResult = {
                normal: 0,
                surcharge_50: 0,
                taxed_100: 0,
                tax_free_100: 0,
                break_time: 0,
                display_break_time: 0
            };

            // Berechne alle Arbeitszeit-Bl√∂cke
            for (const block of timeBlocks) {
                if (block.start && block.end) {
                    const start = timeToMinutes(block.start);
                    const end = timeToMinutes(block.end);
                    const result = calculateTimeSegment(start, end, rules, day, hasPause);
                    
                    Object.keys(totalResult).forEach(key => {
                        if (key !== 'break_time' && key !== 'display_break_time') {
                            totalResult[key] += result[key];
                        }
                    });
                }
            }

            // Pausenzeit-Behandlung
            if (hasPause) {
                if (day === 'monday' || day === 'tuesday' || day === 'wednesday' || day === 'thursday') {
                    // Mo-Do: Pause ist bereits durch √úberspringen der 12:00-12:45 Zeit ber√ºcksichtigt
                    // Keine Abziehung n√∂tig, nur zur Anzeige
                    totalResult.break_time = 0; // Nicht abziehen
                    totalResult.display_break_time = 45; // Nur zur Anzeige
                } else {
                    // Andere Tage: Pausenzeit abziehen
                    totalResult.break_time = 45;
                    totalResult.display_break_time = 45;
                }
            }

            return totalResult;
        }

        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(mode + '-mode').classList.add('active');
        }

        function calculateWorkTime() {
            const day = document.getElementById('workday').value;
            const isHoliday = document.getElementById('isHoliday').value === 'true';
            const hasPause = document.getElementById('hasPause').checked;
            
            // Sammle alle Arbeitszeit-Bl√∂cke
            const timeBlocks = [];
            for (let i = 1; i <= singleModeTimeBlocks; i++) {
                const startTime = getTimeFromSelects(`startHour${i}`, `startMin${i}`);
                const endTime = getTimeFromSelects(`endHour${i}`, `endMin${i}`);
                
                if (startTime && endTime) {
                    timeBlocks.push({
                        start: startTime,
                        end: endTime
                    });
                }
            }

            if (timeBlocks.length === 0) {
                alert('Bitte geben Sie mindestens eine Arbeitszeit ein.');
                return;
            }

            const result = calculateDayWorkTime(timeBlocks, day, isHoliday, hasPause);
            displayResults(result);
        }

        function displayResults(result) {
            const resultDiv = document.getElementById('results');
            const resultContent = document.getElementById('resultContent');
            
            // Bruttoarbeitszeit (alle berechneten Zeitkategorien)
            const totalMinutes = result.normal + result.surcharge_50 + result.taxed_100 + result.tax_free_100;
            // Nettoarbeitszeit (Bruttozeit minus tats√§chliche Pausenzeit)
            const workMinutes = totalMinutes - result.break_time;

            resultContent.innerHTML = `
                <div class="result-item">
                    <div class="label">Gesamtarbeitszeit</div>
                    <div class="value">${minutesToHours(workMinutes)} h</div>
                </div>
                <div class="result-item">
                    <div class="label">Normalstunden</div>
                    <div class="value">${minutesToHours(result.normal)} h</div>
                </div>
                <div class="result-item">
                    <div class="label">50% Zuschlag</div>
                    <div class="value">${minutesToHours(result.surcharge_50)} h</div>
                </div>
                <div class="result-item">
                    <div class="label">100% versteuert</div>
                    <div class="value">${minutesToHours(result.taxed_100)} h</div>
                </div>
                <div class="result-item">
                    <div class="label">100% steuerfrei</div>
                    <div class="value">${minutesToHours(result.tax_free_100)} h</div>
                </div>
                <div class="result-item">
                    <div class="label">Pausenzeit</div>
                    <div class="value">${minutesToHours(result.display_break_time || result.break_time)} h</div>
                </div>
            `;

            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function clearSingle() {
            // Alle Arbeitszeit-Eingaben l√∂schen
            for (let i = 1; i <= singleModeTimeBlocks; i++) {
                const startHourSelect = document.getElementById(`startHour${i}`);
                const startMinSelect = document.getElementById(`startMin${i}`);
                const endHourSelect = document.getElementById(`endHour${i}`);
                const endMinSelect = document.getElementById(`endMin${i}`);
                
                if (startHourSelect) startHourSelect.value = '';
                if (startMinSelect) startMinSelect.value = '';
                if (endHourSelect) endHourSelect.value = '';
                if (endMinSelect) endMinSelect.value = '';
            }
            
            // Zus√§tzliche Bl√∂cke entfernen (nur 1 behalten)
            while (singleModeTimeBlocks > 1) {
                removeTimeBlock();
            }
            
            // Standardwerte wieder setzen
            document.getElementById('startHour1').value = '07';
            document.getElementById('startMin1').value = '30';
            document.getElementById('endHour1').value = '16';
            document.getElementById('endMin1').value = '45';
            
            document.getElementById('workday').value = 'monday';
            document.getElementById('isHoliday').value = 'false';
            document.getElementById('hasPause').checked = false;
            document.getElementById('results').style.display = 'none';
        }

        function generateMonthCalendar() {
            const monthInput = document.getElementById('selectedMonth').value;
            const employeeName = document.getElementById('employeeName').value;

            if (!monthInput || !employeeName) {
                alert('Bitte Name und Monat eingeben.');
                return;
            }

            const [year, month] = monthInput.split('-').map(Number);
            const daysInMonth = new Date(year, month, 0).getDate();
            
            monthData = {};
            
            const calendarDiv = document.getElementById('monthCalendar');
            calendarDiv.innerHTML = '';

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const weekday = getWeekday(date);
                const weekdayName = getWeekdayName(date);
                const fullWeekdayName = getFullWeekdayName(date);
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.innerHTML = `
                    <div class="day-header">
                        <div class="day-number">${day}.</div>
                        <div class="weekday">${day}. ${fullWeekdayName}</div>
                    </div>
                    
                    <div class="form-field" style="margin-bottom: 10px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 5px;">
                            <label style="font-size: 0.8rem;">
                                <input type="checkbox" id="holiday_${day}" onchange="updateDaySummary(${day})"> Feiertag
                            </label>
                            <label style="font-size: 0.8rem;">
                                <input type="checkbox" id="pause_${day}" onchange="updateDaySummary(${day})"> Pause (0:45h)
                            </label>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 5px;">
                            <label style="font-size: 0.8rem;">
                                <input type="checkbox" id="dienst1_${day}" onchange="updateDaySummary(${day})"> Dienst 1
                            </label>
                            <label style="font-size: 0.8rem;">
                                <input type="checkbox" id="dienst2_${day}" onchange="updateDaySummary(${day})"> Dienst 2
                            </label>
                        </div>
                        <div style="margin-top: 5px;">
                            <label style="font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">
                                Einsatzpauschalen (1-9): 
                                <input type="number" 
                                       id="einsatzpauschalen_${day}" 
                                       min="1" 
                                       max="9" 
                                       style="width: 50px; padding: 2px; font-size: 0.8rem;" 
                                       onchange="updateDaySummary(${day})"
                                       placeholder="0">
                            </label>
                        </div>
                    </div>
                    
                    <div id="timeInputs_${day}">
                        <div class="input-labels">
                            <div>Beginn</div>
                            <div>Ende</div>
                        </div>
                        <div class="day-inputs-quick">
                            <input type="text" 
                                   class="time-input-quick" 
                                   id="start1_${day}" 
                                   data-day="${day}"
                                   placeholder="07:30"
                                   onkeydown="handleTimeKeyDown(event)"
                                   onblur="handleTimeBlur(event)"
                                   tabindex="${day * 10 + 1}">
                            <input type="text" 
                                   class="time-input-quick" 
                                   id="end1_${day}" 
                                   data-day="${day}"
                                   placeholder="16:45"
                                   onkeydown="handleTimeKeyDown(event)"
                                   onblur="handleTimeBlur(event)"
                                   tabindex="${day * 10 + 2}">
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin: 10px 0;">
                        <button type="button" onclick="addDayTimeBlock(${day})" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; margin: 2px;">+</button>
                        <button type="button" onclick="removeDayTimeBlock(${day})" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; margin: 2px;">-</button>
                        <button type="button" onclick="copyToWeek(${day})" style="background: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; margin: 2px;">üìã Woche</button>
                    </div>
                    
                    <div id="summary_${day}" class="day-summary">
                        Keine Arbeitszeit eingetragen
                    </div>
                `;
                
                calendarDiv.appendChild(dayCard);
                
                monthData[day] = {
                    weekday: weekday,
                    date: date,
                    isHoliday: false,
                    hasPause: false,
                    dienst1: false,
                    dienst2: false,
                    einsatzpauschalen: 0,
                    timeBlocks: 1
                };
            }
        }

        function updateDaySummary(day) {
            const isHoliday = document.getElementById(`holiday_${day}`).checked;
            const hasPause = document.getElementById(`pause_${day}`).checked;
            const dienst1 = document.getElementById(`dienst1_${day}`).checked;
            const dienst2 = document.getElementById(`dienst2_${day}`).checked;
            const einsatzpauschalen = parseInt(document.getElementById(`einsatzpauschalen_${day}`).value) || 0;
            
            monthData[day].isHoliday = isHoliday;
            monthData[day].hasPause = hasPause;
            monthData[day].dienst1 = dienst1;
            monthData[day].dienst2 = dienst2;
            monthData[day].einsatzpauschalen = einsatzpauschalen;
            
            // Sammle alle Arbeitszeit-Bl√∂cke f√ºr diesen Tag
            const timeBlocks = [];
            for (let i = 1; i <= monthData[day].timeBlocks; i++) {
                const startTime = getTimeFromInput(`start${i}_${day}`);
                const endTime = getTimeFromInput(`end${i}_${day}`);
                
                if (startTime && endTime) {
                    timeBlocks.push({
                        start: startTime,
                        end: endTime
                    });
                }
            }
            
            const summaryDiv = document.getElementById(`summary_${day}`);
            
            if (timeBlocks.length === 0 && !dienst1 && !dienst2 && einsatzpauschalen === 0) {
                summaryDiv.innerHTML = 'Keine Arbeitszeit eingetragen';
                return;
            }
            
            let summaryText = '';
            
            // Arbeitszeit-Zusammenfassung
            if (timeBlocks.length > 0) {
                const result = calculateDayWorkTime(timeBlocks, monthData[day].weekday, isHoliday, hasPause);
                // Bruttoarbeitszeit minus tats√§chliche Pausenzeit = Nettoarbeitszeit
                const totalMinutes = result.normal + result.surcharge_50 + result.taxed_100 + result.tax_free_100;
                const workMinutes = totalMinutes - result.break_time;
                
                summaryText += `Arbeitszeit: ${minutesToHours(workMinutes)} h<br>`;
                summaryText += `Normal: ${minutesToHours(result.normal)} h | 50%: ${minutesToHours(result.surcharge_50)} h<br>`;
                summaryText += `100% versteuert: ${minutesToHours(result.taxed_100)} h | 100% steuerfrei: ${minutesToHours(result.tax_free_100)} h`;
                if ((result.display_break_time || result.break_time) > 0) {
                    summaryText += `<br>Pause: ${minutesToHours(result.display_break_time || result.break_time)} h`;
                }
            }
            
            // Zus√§tzliche Dienste und Pauschalen
            const additionalItems = [];
            if (dienst1) additionalItems.push('Dienst 1');
            if (dienst2) additionalItems.push('Dienst 2');
            if (einsatzpauschalen > 0) additionalItems.push(`${einsatzpauschalen} Einsatzpauschalen`);
            
            if (additionalItems.length > 0) {
                if (summaryText) summaryText += '<br>';
                summaryText += `<strong>Zus√§tzlich:</strong> ${additionalItems.join(', ')}`;
            }
            
            summaryDiv.innerHTML = summaryText || 'Keine Arbeitszeit eingetragen';
        }

        function calculateMonthTotal() {
            if (Object.keys(monthData).length === 0) {
                alert('Bitte erst einen Monat generieren.');
                return;
            }

            let monthTotal = {
                normal: 0,
                surcharge_50: 0,
                taxed_100: 0,
                tax_free_100: 0,
                break_time: 0,
                display_break_time: 0,
                workDays: 0,
                totalWorkTime: 0,
                dienst1Count: 0,
                dienst2Count: 0,
                totalEinsatzpauschalen: 0
            };

            const employeeName = document.getElementById('employeeName').value;
            const monthInput = document.getElementById('selectedMonth').value;

            for (const day in monthData) {
                const dayData = monthData[day];
                
                // Sammle alle Arbeitszeit-Bl√∂cke f√ºr diesen Tag
                const timeBlocks = [];
                for (let i = 1; i <= dayData.timeBlocks; i++) {
                    const startTime = getTimeFromInput(`start${i}_${day}`);
                    const endTime = getTimeFromInput(`end${i}_${day}`);
                    
                    if (startTime && endTime) {
                        timeBlocks.push({
                            start: startTime,
                            end: endTime
                        });
                    }
                }
                
                // Arbeitszeit berechnen
                if (timeBlocks.length > 0) {
                    const result = calculateDayWorkTime(timeBlocks, dayData.weekday, dayData.isHoliday, dayData.hasPause);
                    
                    Object.keys(result).forEach(key => {
                        if (monthTotal[key] !== undefined) {
                            monthTotal[key] += result[key];
                        }
                    });
                    monthTotal.workDays++;
                }
                
                // Zus√§tzliche Dienste und Pauschalen z√§hlen
                if (dayData.dienst1) monthTotal.dienst1Count++;
                if (dayData.dienst2) monthTotal.dienst2Count++;
                if (dayData.einsatzpauschalen) monthTotal.totalEinsatzpauschalen += dayData.einsatzpauschalen;
            }

            monthTotal.totalWorkTime = monthTotal.normal + monthTotal.surcharge_50 + monthTotal.taxed_100 + monthTotal.tax_free_100 - monthTotal.break_time;

            const summaryDiv = document.getElementById('monthSummary');
            const summaryContent = document.getElementById('monthSummaryContent');
            
            summaryContent.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h4>Mitarbeiter: ${employeeName}</h4>
                    <h4>Monat: ${new Date(monthInput + '-01').toLocaleDateString('de-DE', { month: 'long', year: 'numeric' })}</h4>
                </div>
                
                <div class="result-grid">
                    <div class="result-item">
                        <div class="label">Arbeitstage</div>
                        <div class="value">${monthTotal.workDays}</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Gesamtarbeitszeit</div>
                        <div class="value">${minutesToHours(monthTotal.totalWorkTime)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Normalstunden</div>
                        <div class="value">${minutesToHours(monthTotal.normal)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">50% Zuschlag</div>
                        <div class="value">${minutesToHours(monthTotal.surcharge_50)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">100% versteuert</div>
                        <div class="value">${minutesToHours(monthTotal.taxed_100)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">100% steuerfrei</div>
                        <div class="value">${minutesToHours(monthTotal.tax_free_100)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Pausenzeit</div>
                        <div class="value">${minutesToHours(monthTotal.display_break_time || monthTotal.break_time)} h</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Dienst 1</div>
                        <div class="value">${monthTotal.dienst1Count}x</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Dienst 2</div>
                        <div class="value">${monthTotal.dienst2Count}x</div>
                    </div>
                    <div class="result-item">
                        <div class="label">Einsatzpauschalen</div>
                        <div class="value">${monthTotal.totalEinsatzpauschalen}</div>
                    </div>
                </div>
            `;

            generateOfficialPDF(employeeName, monthInput, monthTotal);
            summaryDiv.style.display = 'block';
            summaryDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function generateOfficialPDF(employeeName, monthInput, monthTotal) {
            const printTableDiv = document.getElementById('printTable');
            
            let tableHTML = `
                <div style="max-width: 210mm; margin: 0 auto; padding: 20mm; font-family: Arial, sans-serif; font-size: 11pt; background: white;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; font-size: 16pt; font-weight: bold;">STUNDENLISTE</h2>
                        <div style="font-size: 9pt; margin-top: 5px;">(Mittagspause von 12:00 bis 12:45 Uhr)</div>
                    </div>
                    
                    <div style="margin-bottom: 15px; display: flex; justify-content: space-between;">
                        <div>
                            <strong>NAME:</strong> <span style="border-bottom: 1px solid black; padding-bottom: 2px; min-width: 200px; display: inline-block;">${employeeName}</span>
                        </div>
                        <div>
                            <strong>Monat/Jahr:</strong> <span style="border-bottom: 1px solid black; padding-bottom: 2px; min-width: 150px; display: inline-block;">${new Date(monthInput + '-01').toLocaleDateString('de-DE', { month: '2-digit', year: 'numeric' }).replace('.', '/')}</span>
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; border: 2px solid black; font-size: 9pt;">
                        <thead>
                            <tr style="border-bottom: 2px solid black;">
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 8%; background: #f0f0f0;">TAG</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 12%; background: #f0f0f0;">Datum</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 12%; background: #f0f0f0;">VON</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 12%; background: #f0f0f0;">BIS</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 12%; background: #f0f0f0;">GESAMT</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 8%; background: #f0f0f0;">Dienst</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 8%; background: #f0f0f0;">50%</th>
                                <th style="border: 1px solid black; padding: 4px; text-align: center; width: 28%; background: #f0f0f0;">
                                    √úberstunden<br>
                                    <div style="display: flex; border-top: 1px solid black; margin-top: 2px;">
                                        <div style="flex: 1; padding: 2px; border-right: 1px solid black; text-align: center;">75%</div>
                                        <div style="flex: 1; padding: 2px; border-right: 1px solid black; text-align: center;">100%</div>
                                        <div style="flex: 1; padding: 2px; text-align: center;">100% frei</div>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Generiere Tabellenzeilen f√ºr alle Tage des Monats
            const [year, month] = monthInput.split('-').map(Number);
            const daysInMonth = new Date(year, month, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const paddedDay = day.toString().padStart(2, '0');
                const date = new Date(year, month - 1, day);
                const dateStr = `${paddedDay}.${month.toString().padStart(2, '0')}.`;
                
                let timeDisplay = '';
                let totalHours = '';
                let normal = '';
                let surcharge50 = '';
                let taxed100 = '';
                let taxFree100 = '';
                let result = null;
                
                if (monthData[day]) {
                    // Sammle alle Arbeitszeiten f√ºr diesen Tag
                    const timeBlocks = [];
                    for (let i = 1; i <= monthData[day].timeBlocks; i++) {
                        const startTime = getTimeFromInput(`start${i}_${day}`);
                        const endTime = getTimeFromInput(`end${i}_${day}`);
                        
                        if (startTime && endTime) {
                            timeBlocks.push({
                                start: startTime,
                                end: endTime
                            });
                        }
                    }
                    
                    if (timeBlocks.length > 0) {
                        timeDisplay = timeBlocks.map(block => `${block.start}-${block.end}`).join(', ');
                        
                        result = calculateDayWorkTime(timeBlocks, monthData[day].weekday, monthData[day].isHoliday, monthData[day].hasPause);
                        // Bruttoarbeitszeit minus tats√§chliche Pausenzeit = Nettoarbeitszeit
                        const totalMinutes = result.normal + result.surcharge_50 + result.taxed_100 + result.tax_free_100;
                        const workMinutes = totalMinutes - result.break_time;
                        
                        totalHours = minutesToHours(workMinutes);
                        normal = minutesToHours(result.normal);
                        surcharge50 = minutesToHours(result.surcharge_50);
                        taxed100 = minutesToHours(result.taxed_100);
                        taxFree100 = minutesToHours(result.tax_free_100);
                    }
                }
                
                tableHTML += `
                    <tr style="height: 25px;">
                        <td style="border: 1px solid black; padding: 4px; text-align: center;">${paddedDay}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${dateStr}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${timeDisplay.split(',')[0] ? timeDisplay.split(',')[0].split('-')[0] : ''}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${timeDisplay.split(',')[0] ? timeDisplay.split(',')[0].split('-')[1] : ''}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${totalHours}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${normal}</td>
                        <td style="border: 1px solid black; padding: 4px; text-align: center; font-size: 8pt;">${surcharge50}</td>
                        <td style="border: 1px solid black; padding: 0;">
                            <div style="display: flex; height: 100%;">
                                <div style="flex: 1; padding: 4px; border-right: 1px solid black; text-align: center; font-size: 8pt;">${result ? minutesToHours(result.taxed_100 * 0.75) : ''}</div>
                                <div style="flex: 1; padding: 4px; border-right: 1px solid black; text-align: center; font-size: 8pt;">${taxed100}</div>
                                <div style="flex: 1; padding: 4px; text-align: center; font-size: 8pt;">${taxFree100}</div>
                            </div>
                        </td>
                    </tr>
                `;
            }

            tableHTML += `
                        </tbody>
                        <tfoot>
                            <tr style="background: #f0f0f0; font-weight: bold; border-top: 2px solid black;">
                                <td colspan="4" style="border: 1px solid black; padding: 4px; text-align: center;">SUMME</td>
                                <td style="border: 1px solid black; padding: 4px; text-align: center;">${minutesToHours(monthTotal.totalWorkTime)}</td>
                                <td style="border: 1px solid black; padding: 4px; text-align: center;">${minutesToHours(monthTotal.normal)}</td>
                                <td style="border: 1px solid black; padding: 4px; text-align: center;">${minutesToHours(monthTotal.surcharge_50)}</td>
                                <td style="border: 1px solid black; padding: 0;">
                                    <div style="display: flex; height: 100%;">
                                        <div style="flex: 1; padding: 4px; border-right: 1px solid black; text-align: center;">${minutesToHours(monthTotal.taxed_100 * 0.75)}</div>
                                        <div style="flex: 1; padding: 4px; border-right: 1px solid black; text-align: center;">${minutesToHours(monthTotal.taxed_100)}</div>
                                        <div style="flex: 1; padding: 4px; text-align: center;">${minutesToHours(monthTotal.tax_free_100)}</div>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    <div style="margin-top: 30px; display: flex; justify-content: space-between;">
                        <div style="border-bottom: 1px solid black; width: 200px; text-align: center; padding-bottom: 5px;">
                            <div style="margin-top: 10px; font-size: 9pt;">Unterschrift Arbeitgeber</div>
                        </div>
                        <div style="border-bottom: 1px solid black; width: 200px; text-align: center; padding-bottom: 5px;">
                            <div style="margin-top: 10px; font-size: 9pt;">Unterschrift Arbeitnehmer</div>
                        </div>
                    </div>
                </div>
            `;

            printTableDiv.innerHTML = tableHTML;
        }

        function printOfficialPDF() {
            const printTableDiv = document.getElementById('printTable');
            if (printTableDiv.innerHTML === '') {
                alert('Bitte erst die Monatsauswertung durchf√ºhren.');
                return;
            }
            
            printTableDiv.style.display = 'block';
            
            // Tempor√§re Styles f√ºr den Druck
            const originalStyles = document.head.innerHTML;
            document.head.innerHTML += `
                <style media="print">
                    body * { visibility: hidden; }
                    #printTable, #printTable * { visibility: visible; }
                    #printTable { position: absolute; left: 0; top: 0; }
                    @page { margin: 0.5cm; }
                </style>
            `;
            
            window.print();
            
            // Styles zur√ºcksetzen
            setTimeout(() => {
                printTableDiv.style.display = 'none';
                document.head.innerHTML = originalStyles;
            }, 1000);
        }

        function addTimeBlock() {
            singleModeTimeBlocks++;
            const additionalBlocks = document.getElementById('additionalTimeBlocks');
            
            const newBlock = document.createElement('div');
            newBlock.className = 'time-block';
            newBlock.id = `timeBlock${singleModeTimeBlocks}`;
            newBlock.innerHTML = `
                <h4>üïï Zus√§tzliche Arbeitszeit ${singleModeTimeBlocks - 1}</h4>
                <div class="form-group">
                    <div class="form-field">
                        <label>Beginn</label>
                        <div class="time-input-group">
                            <select id="startHour${singleModeTimeBlocks}">
                                <option value="">--</option>
                            </select>
                            <span class="time-separator">:</span>
                            <select id="startMin${singleModeTimeBlocks}">
                                <option value="">--</option>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-field">
                        <label>Ende</label>
                        <div class="time-input-group">
                            <select id="endHour${singleModeTimeBlocks}">
                                <option value="">--</option>
                            </select>
                            <span class="time-separator">:</span>
                            <select id="endMin${singleModeTimeBlocks}">
                                <option value="">--</option>
                                <option value="00">00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
            
            additionalBlocks.appendChild(newBlock);
            
            // Populate hour options for the new selects - WICHTIG!
            populateHourOptions(document.getElementById(`startHour${singleModeTimeBlocks}`));
            populateHourOptions(document.getElementById(`endHour${singleModeTimeBlocks}`));
        }

        function removeTimeBlock() {
            if (singleModeTimeBlocks > 1) {
                const blockToRemove = document.getElementById(`timeBlock${singleModeTimeBlocks}`);
                if (blockToRemove) {
                    blockToRemove.remove();
                }
                singleModeTimeBlocks--;
            }
        }

        function clearMonth() {
            monthData = {};
            document.getElementById('employeeName').value = '';
            document.getElementById('selectedMonth').value = '';
            document.getElementById('monthCalendar').innerHTML = '';
            document.getElementById('monthSummary').style.display = 'none';
            document.getElementById('printTable').innerHTML = '';
        }

        function fillExampleData() {
            if (Object.keys(monthData).length === 0) {
                alert('Bitte erst einen Monat generieren.');
                return;
            }

            // Beispieldaten f√ºr verschiedene Wochentage
            for (const day in monthData) {
                const dayData = monthData[day];
                const weekday = dayData.weekday;
                
                // Standard Arbeitszeiten je nach Wochentag
                let start1 = '', end1 = '';
                let hasPause = false;
                let hasAdditionalWork = false;
                let start2 = '', end2 = '';
                let dienst1 = false;
                let dienst2 = false;
                let einsatzpauschalen = 0;
                
                switch (weekday) {
                    case 'monday':
                    case 'tuesday':
                    case 'wednesday':
                    case 'thursday':
                        start1 = '07:30';
                        end1 = '16:45';
                        hasPause = true;
                        
                        // Gelegentlich Abendeins√§tze
                        if ((weekday === 'tuesday' || weekday === 'thursday') && day <= 15) {
                            hasAdditionalWork = true;
                            start2 = '19:00';
                            end2 = '22:00';
                        }
                        
                        // Beispiel f√ºr Dienst 1 an bestimmten Tagen
                        if (weekday === 'monday' && day <= 10) {
                            dienst1 = true;
                        }
                        break;
                    case 'friday':
                        start1 = '07:30';
                        end1 = '12:00';
                        hasPause = false;
                        
                        // Freitags manchmal Dienst 2
                        if (day <= 15) {
                            dienst2 = true;
                        }
                        break;
                    case 'saturday':
                        // Nur jeden 2. Samstag
                        if (day % 2 === 0) {
                            start1 = '08:00';
                            end1 = '14:00';
                            einsatzpauschalen = 2; // Beispiel: 2 Einsatzpauschalen am Samstag
                        }
                        break;
                    case 'sunday':
                        // Nur gelegentlich Notdienst
                        if (day === 15) {
                            start1 = '19:00';
                            end1 = '22:30';
                            einsatzpauschalen = 3; // Beispiel: 3 Einsatzpauschalen am Sonntag
                        }
                        break;
                }

                // Eingaben setzen
                const startInput1 = document.getElementById(`start1_${day}`);
                const endInput1 = document.getElementById(`end1_${day}`);
                const pauseCheckbox = document.getElementById(`pause_${day}`);
                const dienst1Checkbox = document.getElementById(`dienst1_${day}`);
                const dienst2Checkbox = document.getElementById(`dienst2_${day}`);
                const einsatzpauschalenInput = document.getElementById(`einsatzpauschalen_${day}`);

                if (startInput1) startInput1.value = start1;
                if (endInput1) endInput1.value = end1;
                if (pauseCheckbox) pauseCheckbox.checked = hasPause;
                if (dienst1Checkbox) dienst1Checkbox.checked = dienst1;
                if (dienst2Checkbox) dienst2Checkbox.checked = dienst2;
                if (einsatzpauschalenInput) einsatzpauschalenInput.value = einsatzpauschalen;

                // Zus√§tzliche Arbeitszeit hinzuf√ºgen falls n√∂tig
                if (hasAdditionalWork) {
                    // F√ºge zweiten Block hinzu
                    if (monthData[day].timeBlocks < 2) {
                        addDayTimeBlock(day);
                    }
                    
                    const startInput2 = document.getElementById(`start2_${day}`);
                    const endInput2 = document.getElementById(`end2_${day}`);
                    
                    if (startInput2) startInput2.value = start2;
                    if (endInput2) endInput2.value = end2;
                }

                monthData[day].hasPause = hasPause;
                monthData[day].dienst1 = dienst1;
                monthData[day].dienst2 = dienst2;
                monthData[day].einsatzpauschalen = einsatzpauschalen;
                updateDaySummary(day);
            }

            alert('Beispieldaten wurden eingef√ºgt! Sie k√∂nnen diese nun bearbeiten oder als Vorlage verwenden.');
        }

        // Beispielwerte setzen beim Laden
        document.addEventListener('DOMContentLoaded', function() {
            // Populate hour options for initial time block
            populateHourOptions(document.getElementById('startHour1'));
            populateHourOptions(document.getElementById('endHour1'));
            
            // Standardwerte f√ºr Einzelberechnung setzen
            document.getElementById('startHour1').value = '07';
            document.getElementById('startMin1').value = '30';
            document.getElementById('endHour1').value = '16';
            document.getElementById('endMin1').value = '45';
            
            // Aktuellen Monat setzen
            const now = new Date();
            const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0');
            document.getElementById('selectedMonth').value = currentMonth;
        });
    </script>
</body>
</html>